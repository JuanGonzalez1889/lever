<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" />
    <title>Registrarse | Lever</title>
    <link rel="stylesheet" href="login.css" />
  </head>
  <body>
    <canvas id="particle-canvas"></canvas>
    <div class="register-container">
      <!-- Columna izquierda: título e imagen -->
      <div class="register-left">
        <div class="register-left-content">
          <h1>Crea tu cuenta en simples pasos</h1>
          <p>Accedé para poder gestionar tu crédito con las mejores condiciones</p>
          <img
            src="./images/car.svg"
            alt="Ilustración registro"
            class="register-illustration"
          />
        </div>
      </div>
      
      <!-- Columna derecha: tu formulario actual -->
      <div class="register-right">
        <div class="login_form">
          <form id="register-form">
            <div itemprop="logo" class="logo-container">
              <a href="index.html">
                <img src="./images/logos/lever.svg" alt="Lever Technology" />
              </a>
            </div>

            <div class="input_box">
              <label for="reg-email">Correo</label>
              <input type="email" id="reg-email" placeholder="" required />
            </div>

            <div class="input_box">
              <label for="reg-password">Contraseña</label>
              <input
                type="password"
                id="reg-password"
                placeholder=""
                required
              />
            </div>

            <div class="input_box">
              <label for="reg-nombre-completo">Nombre completo</label>
              <input
                type="text"
                id="reg-nombre-completo"
                placeholder=""
                required
              />
            </div>

            <div class="input_box">
              <label for="reg-agencia">Agencia</label>
              <input type="text" id="reg-agencia" placeholder="" required />
            </div>

            <div class="input_box">
              <label for="reg-telefono">Teléfono</label>
              <input type="text" id="reg-telefono" placeholder="" required />
            </div>

            <button type="submit">Registrarse</button>

            <p class="sign_up">
              ¿Ya tienes una cuenta? <a href="login.html">Iniciar sesión</a>
            </p>
          </form>
        </div>
      </div>
    </div>
    <div id="modal-validar-email" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail-check" style="display:block;margin:0 auto 1em auto;">
      <path d="M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8"></path>
      <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
      <path d="m16 19 2 2 4-4"></path>
    </svg>
    <h3 style="font-size: 21px; margin-bottom: 9px;">¡Revisa tu correo!</h3>
    <span style="opacity: 0.7;">Te enviamos un email para validar tu cuenta. Debes validarla antes de poder ingresar.</span>
  </div>
</div>
<div id="loader-smiley" class="loader-overlay" style="display: none;">
  <div style="display: flex; flex-direction: column; align-items: center;">
   <svg
    role="img"
    aria-label="Mouth and eyes come from 9:00 and rotate clockwise into position, right eye blinks, then all parts rotate and merge into 3:00"
    class="smiley"
    viewBox="0 0 128 128"
    width="90px"
    height="90px"
   >
    <defs>
      <clipPath id="smiley-eyes">
        <circle class="smiley__eye1" cx="64" cy="64" r="8" transform="rotate(-40,64,64) translate(0,-56)" />
        <circle class="smiley__eye2" cx="64" cy="64" r="8" transform="rotate(40,64,64) translate(0,-56)" />
      </clipPath>
      <linearGradient id="smiley-grad" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#000" />
        <stop offset="100%" stop-color="#fff" />
      </linearGradient>
      <mask id="smiley-mask">
        <rect x="0" y="0" width="128" height="128" fill="url(#smiley-grad)" />
      </mask>
    </defs>
    <g stroke-linecap="round" stroke-width="12" stroke-dasharray="175.93 351.86">
      <g>
        <rect fill="#2ADC9F" width="128" height="64" clip-path="url(#smiley-eyes)" />
        <g fill="none" stroke="#2ADC9F">
          <circle class="smiley__mouth1" cx="64" cy="64" r="56" transform="rotate(180,64,64)" />
          <circle class="smiley__mouth2" cx="64" cy="64" r="56" transform="rotate(0,64,64)" />
        </g>
      </g>
      <g mask="url(#smiley-mask)">
        <rect fill="#2ADC9F" width="128" height="64" clip-path="url(#smiley-eyes)" />
        <g fill="none" stroke="#2ADC9F">
          <circle class="smiley__mouth1" cx="64" cy="64" r="56" transform="rotate(180,64,64)" />
          <circle class="smiley__mouth2" cx="64" cy="64" r="56" transform="rotate(0,64,64)" />
        </g>
      </g>
    </g>
     </svg>
    <div class="loader-text">
      Creando tu cuenta<span class="loader-dots"><span>.</span><span>.</span><span>.</span></span>
    </div>
  </div>
</div>
    <script src="config.js"></script>
    <script src="cotizar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="js/app.min.js"></script>
    <script>
      console.log("Script de registro cargado");

      
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("register-form");
        if (form) {
          form.addEventListener("submit", function (e) {
            e.preventDefault();
            document.getElementById("loader-smiley").style.display = "flex"; // <--- Muestra el loader

            const email = document.getElementById("reg-email").value.trim();
            const password = document.getElementById("reg-password").value;
            const nombre_completo = document.getElementById("reg-nombre-completo").value.trim();
            const agencia = document.getElementById("reg-agencia").value.trim();
            const telefono = document.getElementById("reg-telefono").value.trim();

            fetch(window.APP_CONFIG.API_URL + "/api/registerAgencias", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                nombre_completo,
                email,
                password,
                agencia,
                telefono,
              }),
            })
              .then((res) => res.json())
              .then((data) => {
                document.getElementById("loader-smiley").style.display = "none"; // <--- Oculta el loader
                if (data.success) {
                  // Animar el auto antes de redirigir
                  const car = document.querySelector(".register-illustration");
                  if (car) {
                    car.classList.add("drive-away");
                    setTimeout(() => {
                      mostrarModalValidarEmailYRedirigir();
                    }, 1100);
                  } else {
                    mostrarModalValidarEmailYRedirigir();
                  }
                } else {
                  alert(data.message || "No se pudo registrar");
                }
              })
              .catch(() => {
                document.getElementById("loader-smiley").style.display = "none"; // <--- Oculta el loader en error
                alert("Error de conexión");
              });
          });
        } else {
          console.error("No se encontró el formulario de registro");
        }
        function mostrarModalValidarEmailYRedirigir() {
          document.getElementById("modal-validar-email").style.display = "flex";
          setTimeout(() => {
            window.location.href = "login.html";
          }, 5000); // 5000 ms = 5 segundos
        }
      });
    </script>

    
  </body>
</html>
