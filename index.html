<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
    <title>LEVER: Créditos Prendarios</title>
    <meta name="description"
        content="Calcula tu posible financiación con solo tu DNI. Créditos para Pymes. Posibilitá el financiamiento a los clientes de tu agencia por medio de nosotros.">
    <meta name="keywords"
        content="Créditos prendarios, Financiamiento con DNI, Créditos para Pymes, Préstamos con garantía prendaria, Financiamiento ágil y seguro, Soluciones financieras para empresas, Préstamos con tasas competitivas, Alternativas de financiamiento para negocios, Créditos para clientes de agencias, Préstamos rápidos con garantía, Financiamiento para la compra de autos, Créditos automotrices, Préstamos para comprar vehículos, Financiamiento vehicular con DNI, Créditos prendarios para autos, Comprar auto con préstamo, Financiación rápida para autos, Créditos para adquirir vehículos, Préstamos para vehículos usados, Financiamiento flexible para autos">
    <link rel="icon" href="./images/favicon.svg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="alternate" hreflang="x-default" href="https://lever.io">
    <link rel="alternate" hreflang="en" href="https://lever.io">
    <link rel="alternate" hreflang="es-AR" href="https://lever.io">
    <link rel="alternate" hreflang="es" href="https://lever.io">
    <link rel="stylesheet" type="text/css" href="./css/styles.min.css">
    <meta property="og:title" content="LEVER: Créditos Prendarios">
    <meta property="og:description"
        content="Calcula tu posible financiación con solo tu DNI. Créditos para Pymes. Posibilitá el financiamiento a los clientes de tu agencia por medio de nosotros.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://https://lever.com.ar/images/lever_1920x1080.png">
    <script>function resizer() { var e = window.innerWidth / 1920; window.innerWidth < 980 ? document.documentElement.style.fontSize = "1em" : document.documentElement.style.fontSize = 1.25 * e + "em" } window.addEventListener("load", resizer), window.addEventListener("resize", resizer);</script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
    <header>
        <div class="container">
            <div itemprop="logo"><a href="#"><img src="./images/logos/lever.svg" width="226px" height="50px"
                        alt="Lever Technology"></a></div><a href="#" class="hamburguer"><span>Menu</span></a>
            <nav id="menu" itemprop="mainEntityOfPage" itemscope itemtype="http://schema.org/SiteNavigationElement">
                <ul>
                    <li><a href="#" itemprop="url" class="scroller outline" data-text="Inicio" data-url="#inicio"><span
                                itemprop="name">Inicio</span></a></li>
                    <li><a href="#" itemprop="url" class="scroller outline" data-text="Nosotros"
                            data-url="#nosotros"><span itemprop="name">Nosotros</span></a></li>
                    <li><a href="#" itemprop="url" class="scroller outline" data-text="Contacto"
                            data-url="#contacto"><span itemprop="name">Contacto</span></a></li>
                    <li><button class="btn_outline picker-link">COTIZÁ AHORA</button></li>
                </ul>
            </nav>
        </div>
    </header>
    <aside>
        <div>
            <h3 class="picker-link">CALCULÁ TU CRÉDITO<br>AHORA</h3>
        </div>
        <div class="calculadora-container"><img class="picker-link" src="./images/icons/calculator.svg" alt="">
            <div class="calculadora">
                <h3>CALCULÁ TU CRÉDITO AHORA <a href="#" class="close-btn"><img src="./images/icons/close.svg"
                            alt="close btn"></a></h3>
                <div class="container-flex initial-page">
                    <form action="#" class="form-calculator-container">
                        <div class="select-container"><select name="ano" id="anio">
                                <option disabled="disabled" selected="selected">AÑO</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                            </select></div>
                        <div class="select-container"><img class="loader-icon loader-icon-select"
                                id="loader-icon-select-marcas" src="./images/icons/loader.svg" alt="loader"> <select
                                name="marcas" id="marcas">
                                <option>MARCA</option>
                            </select></div>
                        <div class="select-container"><img class="loader-icon loader-icon-select"
                                id="loader-icon-select-modelos" src="./images/icons/loader.svg" alt="loader"> <select
                                name="modelos" id="modelos">
                                <option>MODELO</option>
                            </select></div>
                        <div class="btn-container"><button id="btn-avanzar" class="btn dark custom"
                                disabled="disabled">AVANZAR</button></div>
                    </form>
                    <div><img src="./images/calculadora/calculadora-big.png" alt="" class="calculadora-img"></div>
                </div>
                <div class="container-flex second-page hidden">
                    <form action="#" class="" style="color: black; font-size: 1rem; width: 100%;">
                        <div class="descripcion">
                            <div class="descripcion-container">
                                <div class="descripcion-container__img">
                                    <div class="car-logo"></div>
                                </div>
                                <div class="descripcion-container__text">
                                    <p class="marca"></p>
                                    <p class="modelo"></p>
                                    <p class="año"></p>
                                </div>
                            </div>
                            <div class="valor-de-mercado-container" style="display: none;">
                                <div>
                                    <p class="valor-de-mercado-title">Valor de mercado</p>
                                </div>
                            </div>
                        </div>
                        <div class="seguro">
                            <div class="seguro-container">
                                <div class="seguro-container__input">
                                    <div class="switch-container"><label class="toggle-switch"><input id="switch-input"
                                                type="checkbox"> <span class="switch-slider"></span> <span
                                                class="switch-label">Seguro en banco</span> <span
                                                class="switch-label">Seguro liberado</span></label></div>
                                    <div class="container-info"><a href="#">?<div class="pop-up">
                                                <p><span>Seguro en banco</span>: El cliente elige entre compañías
                                                    aseguradoras ofrecidas por el banco.</p>
                                                <p><span>Seguro liberado</span>: El cliente gestiona seguro con su
                                                    productor y presenta al banco para su aprobación.</p>
                                            </div></a></div>
                                    <div class="monto-a-financiar-mobile">
                                        <p>Monto a financiar</p>
                                    </div><input class="" type="text" id="monto-ingresado" pattern="[0-9]"
                                        inputmode="decimal" placeholder="¿CUÁNTO DINERO NECESITÁS?">
                                    <div>
                                        <p class="error-msj">El valor ingresado debe ser mayor a 1 millón de pesos</p>
                                    </div>
                                    <div class="cuotas-mobile">
                                        <div class="card-cuota-mobile">
                                            <p class="cuota"><span>12</span> CUOTAS</p>
                                            <p class="financiacion-en-12 cuota-valor"><img class="loader-icon"
                                                    src="./images/icons/loader.svg" alt="loader"></p>
                                        </div>
                                        <div class="card-cuota-mobile">
                                            <p class="cuota"><span>24</span> CUOTAS</p>
                                            <p class="financiacion-en-24 cuota-valor"><img class="loader-icon"
                                                    src="./images/icons/loader.svg" alt="loader"></p>
                                        </div>
                                        <div class="card-cuota-mobile destacada mas-elegida-mobile">
                                            <div class="white-star-container">
                                                <div><img class="white-star" src="./images/icons/white-star.svg"
                                                        alt="white-star"></div>
                                            </div>
                                            <div class="cuota-container">
                                                <p class="mas-elegida">MÁS ELEGIDA</p>
                                                <p class="cuota"><span>36</span> CUOTAS</p>
                                            </div>
                                            <div class="cuota-valor-container">
                                                <p class="financiacion-en-36 cuota-valor"><img class="loader-icon"
                                                        src="./images/icons/loader.svg" alt="loader"></p>
                                            </div>
                                        </div>
                                        <div class="card-cuota-mobile">
                                            <p class="cuota"><span>48</span> CUOTAS</p>
                                            <p class="financiacion-en-48 cuota-valor"><img class="loader-icon"
                                                    src="./images/icons/loader.svg" alt="loader"></p>
                                        </div>
                                        <div class="card-cuota-mobile">
                                            <p class="cuota"><span>60</span> CUOTAS</p>
                                            <p class="financiacion-en-60 cuota-valor"><img class="loader-icon"
                                                    src="./images/icons/loader.svg" alt="loader"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="max-financiar">
                                <div>
                                    <p>Máximo a financiar:</p>
                                    <p class="maximo-a-financiar"><span class="loader-container"><img
                                                class="loader-icon" src="./images/icons/loader.svg" alt="loader"></span>
                                    </p>
                                </div>
                            </div>
                            <div class="ver-cuotas"><button class="ver-cuotas-btn">VER CUOTAS</button></div>
                            <div class="cotizar-mobile"><button class="volver-btn">VOLVER</button> <a href=""
                                    class="cotizar-btn" target="_blank">COTIZAR</a></div>
                        </div>
                        <div class="cuotas">
                            <div class="card-cuota">
                                <p class="cuota"><span>12</span><br>CUOTAS</p>
                                <p class="financiacion-en-12 cuota-valor"><img class="loader-icon"
                                        src="./images/icons/loader.svg" alt="loader"></p>
                            </div>
                            <div class="card-cuota">
                                <p class="cuota"><span>24</span><br>CUOTAS</p>
                                <p class="financiacion-en-24 cuota-valor"><img class="loader-icon"
                                        src="./images/icons/loader.svg" alt="loader"></p>
                            </div>
                            <div class="card-cuota destacada">
                                <div class="destacada-titulo"><img class="blue-star" src="./images/icons/blue-star.svg"
                                        alt="blue-star">
                                    <p class="mas-elegida">MÁS ELEGIDA</p>
                                </div>
                                <p class="cuota"><span>36</span><br>CUOTAS</p>
                                <p class="financiacion-en-36 cuota-valor"><img class="loader-icon"
                                        src="./images/icons/loader.svg" alt="loader"></p>
                            </div>
                            <div class="card-cuota">
                                <p class="cuota"><span>48</span><br>CUOTAS</p>
                                <p class="financiacion-en-48 cuota-valor"><img class="loader-icon"
                                        src="./images/icons/loader.svg" alt="loader"></p>
                            </div>
                            <div class="card-cuota">
                                <p class="cuota"><span>60</span><br>CUOTAS</p>
                                <p class="financiacion-en-60 cuota-valor"><img class="loader-icon"
                                        src="./images/icons/loader.svg" alt="loader"></p>
                            </div>
                        </div>
                        <div class="cotizar">
                            <div><a id="get-quote-btn" target="_blank" class="btn-calculadora"></a></div><button
                                id="btn-seleccionar-vehiculo"></button>
                            <div class="container-info"><a href="#">i<div class="pop-up">
                                        <p>Estimación de <strong>CUOTA PROMEDIO</strong> con menor tasa disponible a la
                                            fecha, sujeto a proceso de cotización y calificación del solicitante en cada
                                            entidad bancaria con las que opera LEVER SRL. No incluye impuestos de sellos
                                            de prenda, ni seguro del bien.</p>
                                    </div></a></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </aside>
    <main>
        <section id="inicio">
            <div class="fullhero">
                <div class="container">
                    <div>
                        <h1>LA <em>PALANCA</em> QUE NECESITÁS<br><strong>PARA TUS CLIENTES</strong></h1>
                        <h2>Con más de <strong>dos décadas de experiencia</strong>,<br>ofrecemos <strong>atención ágil y
                                personalizada</strong><br>junto con el <strong>mejor financiamiento
                                posible</strong><br>para tus compradores.<p></p>
                            <div class="btn_container"><button class="btn picker-link">COTIZÁ AHORA</button></div>
                        </h2>
                    </div>
                    <div>
                        <div class="can"><img src="./images/car.png" alt=""></div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="steps">
                    <div><mark>1</mark>
                        <div>
                            <h3>CALCULÁ</h3>
                            <p>EL CRÉDITO PRENDARIO<br class="onlymobile"><br>CON NUESTRA <br
                                    class="onlymobile">CALCULADORA <br>ONLINE</p>
                        </div>
                    </div>
                    <div class="divisor"></div>
                    <div class="second"><mark>2</mark>
                        <div>
                            <h3>COTIZÁ</h3>
                            <p>PARA ACCEDER A LA<br class="onlymobile"><br>FINANCIACIÓN<br class="onlymobile"><br>EN EL
                                ACTO</p>
                        </div>
                    </div>
                    <div class="divisor"></div>
                    <div><mark>3</mark>
                        <div>
                            <h3>LISTO!</h3>
                            <p>FIRMÁ EL CRÉDITO Y <br class="onlymobile">EN 48 HS. <br>TENÉS EL DINERO<br
                                    class="onlymobile"><br>ACREDITADO</p>
                        </div>
                    </div>
                </div>
            </div><canvas id="particle-canvas"></canvas>
        </section>
        <section id="nosotros">
            <div class="container">
                <div class="bubbles">
                    <div class="bubble bubble01">
                        <div><mark class="odometer animated fadeIn" data-value="1474"></mark>
                            <p><strong>CRÉDITOS</strong></p>
                            <p>OTORGADOS EN<br>DOS AÑOS</p>
                        </div>
                    </div>
                    <div class="bubble bubble02">
                        <div><mark class="odometer animated fadeIn" data-value="28"></mark>
                            <p><strong>AÑOS</strong></p>
                            <p>DE EXPERIENCIA<br>EN EL SECTOR</p>
                        </div>
                    </div>
                    <div class="bubble bubble03">
                        <div>
                            <p>OPERAMOS EN</p><mark class="odometer animated fadeIn" data-value="3"></mark>
                            <p><strong>PROVINCIAS</strong></p>
                        </div>
                    </div>
                    <div class="bubble bubble04">
                        <div><mark class="odometer animated fadeIn" data-value="76"></mark>
                            <p><strong>AGENCIAS</strong></p>
                            <p>OPERAN CON<br>NOSOTROS</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container wrapped">
                <div class="videos-container"><button id="prev-video" class="videocontrol"></button> <button
                        id="next-video" class="videocontrol"></button></div>
                <div class="videos">
                    <div><a href="#" class="video_thumb" data-video="1"><img src="./images/videos/01.svg" alt=""></a>
                    </div>
                    <div><a href="#" class="video_thumb" data-video="2"><img src="./images/videos/02.svg" alt=""></a>
                    </div>
                    <div><a href="#" class="video_thumb" data-video="3"><img src="./images/videos/03.svg" alt=""></a>
                    </div>
                </div>
            </div>
            <div class="videowrap"><label class="closebox"><img src="./images/icons/close.svg" alt="close btn"></label>
                <div class="video-container"><iframe id="video" frameborder="0" allowfullscreen autoplay
                        muted="muted"></iframe></div>
            </div>
        </section>
        <section id="contacto">
            <div class="container wrap center">
                <h2 class="title">CONTACTANOS <strong>AHORA</strong></h2><a
                    href="https://wa.me/+5493417049138?text=Buenas%20tardes%2C%20busco%20informaci%C3%B3n%20para%20obtener%20financiaci%C3%B3n%20con%20Lever"
                    class="btn" target="_blank">Enviar Mensaje</a>
            </div>
        </section>
        <footer>
            <div class="container center">
                <div class="not-center"><img src="./images/logos/lever.svg" class="logo" width="226px" height="50px"
                        alt="Lever Technology"></div>
                <div>
                    <nav class="menu" itemprop="mainEntityOfPage" itemscope
                        itemtype="http://schema.org/SiteNavigationElement">
                        <ul>
                            <li><a href="#" itemprop="url" class="scroller outline" data-text="Inicio"
                                    data-url="#inicio"><span itemprop="name">Inicio</span></a></li>
                            <li><a href="#" itemprop="url" class="scroller outline" data-text="Nosotros"
                                    data-url="#nosotros"><span itemprop="name">Nosotros</span></a></li>
                            <li><a href="#" itemprop="url" class="scroller outline" data-text="Contacto"
                                    data-url="#contacto"><span itemprop="name">Contacto</span></a></li>
                            <li><a href="#" itemprop="url" class="scroller outline" data-text="Cotizar"
                                    data-url="#contacto"><span itemprop="name">Cotizar</span></a></li>
                        </ul>
                    </nav>
                </div>
                <div class="not-center">
                    <div class="social"><a href="https://www.instagram.com/lever_srl/" target="_blank"><img
                                src="./images/social/instagram.svg" alt=""></a><a
                            href="https://www.linkedin.com/company/leversrl" target="_blank"><img
                                src="./images/social/linkedin.svg" alt=""></a><a
                            href="https://www.youtube.com/@LeverCreditosPrendarios" target="_blank"><img
                                src="./images/social/youtube.svg" alt=""></a></div>
                </div>
            </div>
        </footer>
    </main>
    <script defer="defer" src="https://github.hubspot.com/odometer/odometer.js"></script>
    <script defer="defer" src="./js/app.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        const API_URL = location.hostname === 'localhost' ? 'http://localhost:5000' : 'https://api.lever.com.ar';
        console.log('API_URL:', API_URL);
    </script>
    <script>let marcas = document.getElementById("marcas");
        let modelos = document.getElementById("modelos");
        let anio = document.getElementById("anio");
        let precio = null;
        var valorIngresado = null;
        let maxAFinanciar;
     
        let selectedProduct = "a"; //producto seleccionado por defecto.
        let showSecondPageMobile = false;
        let mensaje = '';
        let mensajeDeError = document.querySelector(".error-msj");
        let cardCuotaContainer = document.querySelectorAll('.card-cuota');

        let dataWithLogo = [];
        let accessToken = null;

        //let valorDeMercadoContainer = document.querySelector('.valor-de-mercado');
        let valorMaxAFinanciarContainer = document.querySelector('.maximo-a-financiar');
        let montoSolicitadoContainer = document.getElementById('monto-ingresado');
        let cuotasMobileContainer = document.querySelector('.cuotas-mobile');
        let cotizarMobileContainer = document.querySelector('.cotizar-mobile');
        let logoContainer = document.querySelector('.car-logo');

        let btnAvanzar = document.getElementById("btn-avanzar");
        let btnSelectCar = document.getElementById("btn-seleccionar-vehiculo");
        let btnSwitchProductValue = document.querySelector('.toggle-switch');
        let btnCotizarDesktop = document.getElementById("get-quote-btn");
        let btnCotizarMobile = document.querySelector('.cotizar-btn');

        let initialPage = document.querySelector(".initial-page");
        let secondPage = document.querySelector(".second-page");

        let loaderIconSelectMarcas = document.getElementById("loader-icon-select-marcas");
        let loaderIconSelectModelos = document.getElementById("loader-icon-select-modelos");

        let btnVerCuotas = document.querySelector('.ver-cuotas-btn');
        let btnVolver = document.querySelector('.volver-btn');

        let descripcionAutoContainer = document.querySelector('.descripcion-container__text');

        let ltvData;
        let minAFinanciar;

        // Cargar datos de la calculadora desde el nuevo endpoint
        const fetchCalculadoraData = async () => {
            try {
                const response = await fetch(`${API_URL}/api/calculadora`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                ltvData = data.productos;
                minAFinanciar = data.minAFinanciar;
                console.log('Datos de la calculadora cargados:', { ltvData, minAFinanciar });
            } catch (error) {
                console.error('Error al cargar los datos de la calculadora:', error);
            }
        };

        // Llamar a fetchCalculadoraData al cargar la página
        window.onload = async () => {
            try {
                await fetchCalculadoraData(); // Cargar los datos desde el nuevo endpoint
                await setProductInSessionStorage(selectedProduct); // Configurar el producto por defecto
            } catch (error) {
                console.error('Error durante la inicialización:', error);
            }
        };

        //========================================================================

        const getLogo = (id) => {
            let element = dataWithLogo.find(element => element.id == id);
            if (element.logo === null) {
                //logoContainer.innerHTML = `<img src="./images/logos/generic-logo.png" alt="car-logo">`;
                logoContainer.parentElement.style.display = 'none';
                descripcionAutoContainer.style = 'padding-left: 15px !important';
            } else {
                logoContainer.innerHTML = `<img src="${element.logo}" alt="car-logo">`;
            }
        }


        function toTitleCase(str) {
            // Convierte la cadena a minúsculas y luego divide la cadena en un array de palabras
            let words = str.toLowerCase().split(" ");

            // Capitaliza la primera letra de cada palabra
            for (let i = 0; i < words.length; i++) {
                words[i] = words[i][0].toUpperCase() + words[i].substring(1);
            }

            // Une las palabras de nuevo en una sola cadena y retorna el resultado
            return words.join(" ");
        }

        const sendWhatsAppMessage = () => {
            let añoWhatsApp = document.querySelector('.año').textContent;
            let marcaWhatsApp = document.querySelector('.marca').textContent;
            let modeloWhatsApp = document.querySelector('.modelo').textContent;
            //let valorDelVehiculoWhatsApp = valorDeMercadoContainer.textContent;

            let maxAFinanciarWhatsApp = valorMaxAFinanciarContainer.textContent;
            let montoSolicitadoWhatsApp = montoSolicitadoContainer.value.replace(/[\.$]/g, '');

            let productoSolicitado;

            if (selectedProduct == "a") {
                productoSolicitado = "Seguro en Banco";
            } else if (selectedProduct == "b") {
                productoSolicitado = "Seguro liberado";
            }

            if (montoSolicitadoWhatsApp === null || isNaN(montoSolicitadoWhatsApp) || montoSolicitadoWhatsApp === "") {
                montoSolicitadoWhatsApp = maxAFinanciarWhatsApp.replace(/\$/g, '');
            } else if (montoSolicitadoWhatsApp < minAFinanciar) {
                montoSolicitadoWhatsApp = "El monto solicitado debe ser mayor a 1 millón de pesos";
            } else {
                montoSolicitadoWhatsApp = parseInt(montoSolicitadoWhatsApp, 10).toLocaleString('es-AR');
            }

            //mensaje = `Hola quiero pedir un prestamo con Lever, estos son los datos para el mismo:\n\n- Año: ${añoWhatsApp}\n- Marca: ${marcaWhatsApp}\n- Modelo: ${modeloWhatsApp}\n- Valor del Vehiculo: ${valorDelVehiculoWhatsApp}\n- Máximo a Financiar: ${maxAFinanciarWhatsApp}\n- Monto Solicitado: $${montoSolicitadoWhatsApp}\n- Producto: ${productoSolicitado}\n`;

            mensaje = `Hola quiero pedir un prestamo con Lever, estos son los datos para el mismo:\n\n- Año: ${añoWhatsApp}\n- Marca: ${marcaWhatsApp}\n- Modelo: ${modeloWhatsApp}\n- Máximo a Financiar: ${maxAFinanciarWhatsApp}\n- Monto Solicitado: $${montoSolicitadoWhatsApp}\n- Producto: ${productoSolicitado}\n`;

            window.open(`https://wa.me/+5493417049138?text=${encodeURIComponent(mensaje)}`, '_blank');

        }

        const fetchMarcas = (year) => {
            loaderIconSelectMarcas.style = "display: block;";
            accessToken = isTokenExpired(localStorage.getItem('accessToken')) || '' ? null : localStorage.getItem('accessToken');

            let body = {
                year,
                accessToken,
                "action": "getBrandsByYear"
            };

            const opcionesFetch = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            };

            marcas.innerHTML = "<option disabled selected>MARCA</option>";
            modelos.innerHTML = "<option disabled selected>MODELO</option>";

            fetch('php/curl.php', opcionesFetch) // Mantener esta llamada porque es de infoauto
                .then(res => res.json())
                .then(data => {
                    accessToken = localStorage.setItem('accessToken', data.accessToken);

                    data.brands.forEach(element => {
                        loaderIconSelectMarcas.style = "display: none;";
                        marcas.innerHTML += "<option value=" + element.id + "> " + element.name + "</option>";
                    });

                    dataWithLogo = data.brands;
                });
        }

        const fetchModelos = (idMarca, year) => {
            loaderIconSelectModelos.style = "display: block;";
            accessToken = isTokenExpired(localStorage.getItem('accessToken')) || '' ? null : localStorage.getItem('accessToken');

            let body = {
                idMarca,
                year,
                accessToken,
                "action": "getModelsByBrand"
            };

            const opcionesFetch = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            };

            modelos.innerHTML = "<option disabled selected>MODELO</option>";

            fetch('php/curl.php', opcionesFetch) // Mantener esta llamada porque es de infoauto
                .then(res => res.json())
                .then(data => {
                    accessToken = localStorage.setItem('accessToken', data.accessToken);

                    data.models.forEach(element => {
                        loaderIconSelectModelos.style = "display: none;";
                        modelos.innerHTML += "<option value=" + element.codia + "> " + element.modelo + "</option>";
                    });
                });

            getLogo(idMarca);
        }

        const fetchPriceCar = (codia, year) => {
            accessToken = isTokenExpired(localStorage.getItem('accessToken')) || '' ? null : localStorage.getItem('accessToken');

            let body = {
                codia,
                year,
                accessToken,
                "action": "getPriceByCodia"
            };

            const opcionesFetch = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            };

            fetch('php/curl.php', opcionesFetch) // Mantener esta llamada porque es de infoauto
                .then(res => res.json())
                .then(data => {
                    precio = data.price;
                    if (ltvData[selectedProduct] && ltvData[selectedProduct].ltv[year]) {
                        maxAFinanciar = precio * ltvData[selectedProduct].ltv[year];
                        console.log('LTV leído:', ltvData[selectedProduct].ltv[year]);
                        valorMaxAFinanciarContainer.innerHTML = `<span>$</span>${maxAFinanciar.toLocaleString('es-AR')}`;
                        setDeafaultFinancingValues();
                    } else {
                        console.error('No se encontró LTV para el producto o año seleccionado.');
                    }
                });
        }

        //Establece el valor por defecto de las cuotas cuando se muestra el secondPage
        const setDeafaultFinancingValues = () => {
            //let datos = JSON.parse(sessionStorage.getItem('data'));

            // desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[12].interest), 12, datos.plazos[12].fee);
            // if(selectedProduct === "a") {
            //     desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[18].interest), 18, datos.plazos[18].fee);
            // }
            // desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[24].interest), 24, datos.plazos[24].fee);
            // desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[36].interest), 36, datos.plazos[36].fee);
            // desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[48].interest), 48, datos.plazos[48].fee);
            // desglosarCuotas(maxAFinanciar, parseFloat(datos.plazos[60].interest), 60, datos.plazos[60].fee);
            document.querySelectorAll(`.cuota-valor`).forEach((element) => {
                element.innerText = '--';
            });
            cardCuotaContainer.forEach((element) => {
                element.style.width = '16%';
            });
        }

        // Actualizar setFinancingValues para usar ltvData directamente
        const setFinancingValues = () => {
            try {
                const productoSeleccionado = ltvData[selectedProduct];
                if (!productoSeleccionado) {
                    console.error('No se encontraron datos válidos para el producto seleccionado.');
                    return;
                }

                const plazos = productoSeleccionado.plazos;
                maxAFinanciar = precio * productoSeleccionado.ltv[anio.value];
                console.log('LTV leído:', productoSeleccionado.ltv[anio.value]);

                valorMaxAFinanciarContainer.innerHTML = `<span>$</span>${maxAFinanciar.toLocaleString('es-AR')}`;

                if (valorIngresado === null || isNaN(valorIngresado) || valorIngresado === "" || valorIngresado > maxAFinanciar) {
                    mensajeDeError.style = "display: none";
                    document.querySelectorAll(`.cuota-valor`).forEach((element) => {
                        element.innerText = '--';
                    });
                } else if (!isNaN(valorIngresado) && valorIngresado <= maxAFinanciar) {
                    [12, 24, 36, 48, 60].forEach(plazo => {
                        if (plazos[plazo]) {
                            desglosarCuotas(valorIngresado, parseFloat(plazos[plazo].interest), plazo, plazos[plazo].fee);
                        } else {
                            console.warn(`No se encontraron datos para el plazo ${plazo}`);
                        }
                    });
                }
            } catch (error) {
                console.error('Error al calcular los valores de financiación:', error);
            }
        };

        // Corregir desglosarCuotas para manejar datos directamente
        const desglosarCuotas = (montoPrincipal, tasaInteresAnual, plazo, feeValor) => {
            if (montoPrincipal >= minAFinanciar) {
                mensajeDeError.style = "display: none";
                montoSolicitadoContainer.classList.remove("error-active");
                btnCotizarDesktop.classList.remove('disabled');
                btnCotizarMobile.classList.remove('disabled');

                const interesMensual = (tasaInteresAnual / 100) / 12;
                const comision = montoPrincipal * (feeValor * 1.21);
                let saldo = montoPrincipal + comision;
                const cuotaMensual = calcularCuota(saldo, tasaInteresAnual, plazo);
                let basePromedio = 0;

                for (let i = 1; i <= plazo; i++) {
                    const interesCuota = saldo * interesMensual;
                    const iva = interesCuota * 0.21;
                    const capitalCuota = cuotaMensual - interesCuota;
                    const cuotaConIva = cuotaMensual + iva;
                    saldo -= capitalCuota;

                    basePromedio += cuotaConIva;
                }

                const cuotaPromedio = basePromedio / plazo;
                const cuotaPromedioFormateada = parseFloat(cuotaPromedio.toFixed(0)).toLocaleString('es-AR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

                document.querySelectorAll(`.financiacion-en-${plazo}`).forEach((element) => {
                    element.innerHTML = `<span>$</span>${cuotaPromedioFormateada}`;
                });

            } else if (montoPrincipal < minAFinanciar) {
                mensajeDeError.innerText = `El valor ingresado debe ser mayor a $${minAFinanciar.toLocaleString('es-AR', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
                mensajeDeError.style = "display: inline-block";
                montoSolicitadoContainer.classList.add("error-active");
                btnCotizarDesktop.classList.add('disabled');
                btnCotizarMobile.classList.add('disabled');

                document.querySelectorAll(`.financiacion-en-${plazo}`).forEach((element) => {
                    element.innerText = '--';
                });
            }
        };

        // Actualizar setProductInSessionStorage para usar ltvData directamente
        const setProductInSessionStorage = async (selectedProduct) => {
            try {
                const productoSeleccionado = ltvData[selectedProduct];
                if (!productoSeleccionado) {
                    console.error(`Producto ${selectedProduct} no encontrado en los datos cargados.`);
                    return;
                }

                console.log('Producto seleccionado configurado:', productoSeleccionado);
            } catch (error) {
                console.error('Error al procesar los datos del producto:', error);
            }
        };

        const calcularCuota = (montoPrincipal, tasaInteresAnual, plazo) => {
            const interesMensual = (tasaInteresAnual / 100) / 12;
            const factor = Math.pow(1 + interesMensual, plazo);
            const cuotaMensual = montoPrincipal * interesMensual * factor / (factor - 1);
            return cuotaMensual;
        };


        const setTextSelectCar = () => {
            if (window.innerWidth > 767) {
                btnSelectCar.innerText = "SELECCIONAR OTRO VEHICULO";
            } else {
                btnSelectCar.innerText = "MODIFICAR VEHICULO";
            }

            window.addEventListener('resize', () => {
                if (window.innerWidth > 767) {
                    btnSelectCar.innerText = "SELECCIONAR OTRO VEHICULO";
                } else {
                    btnSelectCar.innerText = "MODIFICAR VEHICULO";
                }
            });
        }

        showPageMobileWhitOutfinancing = () => {
            montoSolicitadoContainer.classList.remove("input-second-page-mobile");

            cuotasMobileContainer.style = "display: none";
            cotizarMobileContainer.style = "display: none";
            document.querySelector(".monto-a-financiar-mobile").style = "display: none";

            btnVerCuotas.style = "display: inline;";

            document.querySelector(".ver-cuotas").style = "display: flex";
            document.querySelector(".max-financiar").style = "display: flex";
        }

        const resetValues = () => {
            secondPage.classList.add("hidden");
            initialPage.classList.remove("hidden");
            btnAvanzar.disabled = true;
            marcas.innerHTML = "<option disabled selected>MARCA</option>";
            modelos.innerHTML = "<option disabled selected>MODELO</option>";
            anio.selectedIndex = 0;
            dataWithLogo = [];
            selectedProduct = "a";
            valorMaxAFinanciarContainer.innerHTML = "<span class='loader-container'><img class='loader-icon' src='./images/icons/loader.svg' alt='loader'></span>";
            montoSolicitadoContainer.value = '';
            montoSolicitadoContainer.classList.remove("error-active");
            btnCotizarDesktop.classList.remove('disabled');
            btnCotizarMobile.classList.remove('disabled');
            logoContainer.parentElement.style.display = 'flex';
            descripcionAutoContainer.style = 'padding-left: 0px !important';
            document.querySelectorAll(".cuota-valor").forEach((element) => {
                element.innerHTML = "<img class='loader-icon' src='./images/icons/loader.svg' alt='loader'>";
            });
            document.querySelector('input[type="checkbox"]').checked = false;
            setProductInSessionStorage("a");
            mensajeDeError.style = "display: none";
        }

        //========================================================================

        const fetchProductsFromDB = async () => {
            try {
                const response = await fetch('php/curl.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'getProductsFromDB' })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Productos obtenidos de la base de datos:', data.productos);

                // Actualizar sessionStorage con los datos obtenidos
                sessionStorage.setItem('productosDB', JSON.stringify(data.productos));
            } catch (error) {
                console.error('Error al obtener productos de la base de datos:', error);
            }
        };

        // Llamar a fetchLtvAndMinAFinanciar al cargar la página
        window.onload = async () => {
            try {
                await fetchCalculadoraData(); // Cargar los datos desde el nuevo endpoint
                await setProductInSessionStorage(selectedProduct); // Configurar el producto por defecto
            } catch (error) {
                console.error('Error durante la inicialización:', error);
            }
        };

        setTextSelectCar();

        //========================================================================

        anio.addEventListener("change", () => {
            fetchMarcas(anio.value);
        });

        marcas.addEventListener("change", () => {
            fetchModelos(marcas.value, anio.value);
        });

        modelos.addEventListener("change", () => {
            btnAvanzar.disabled = false;
        });

        //botón página inicial.
        btnAvanzar.addEventListener('click', (event) => {
            event.preventDefault();
            fetchPriceCar(modelos.value, anio.value);
            let marcaFormateada = toTitleCase(marcas.options[marcas.selectedIndex].text);

            document.querySelector(".año").innerHTML = `<span>${anio.options[anio.selectedIndex].text}</span>`;
            document.querySelector(".marca").innerText = marcaFormateada;
            document.querySelector(".modelo").innerText = modelos.options[modelos.selectedIndex].text;

            secondPage.classList.remove("hidden");
            showSecondPageMobile = false;
            initialPage.classList.add("hidden");

            if (window.innerWidth > 767) {
                btnVerCuotas.style = "display: none !important;";
            }

        })

        // Corregir btnSwitchProductValue para manejar datos directamente
        btnSwitchProductValue.addEventListener('click', async function () {
            const checkbox = this.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;

            selectedProduct = checkbox.checked ? "b" : "a";

            // Mostrar el LTV del producto seleccionado incluso si no se ha ingresado un capital
            if (precio) {
                maxAFinanciar = precio * ltvData[selectedProduct].ltv[anio.value];
                valorMaxAFinanciarContainer.innerHTML = `<span>$</span>${maxAFinanciar.toLocaleString('es-AR')}`;
            }

            // Validar si el campo de "capital a financiar" está vacío antes de calcular las cuotas
            if (montoSolicitadoContainer.value.trim() === '') {
                document.querySelectorAll(`.cuota-valor`).forEach((element) => {
                    element.innerText = '--';
                });
                return;
            }

            // Validar si el capital a financiar supera el máximo permitido
            if (valorIngresado > maxAFinanciar) {
                mensajeDeError.innerText = "No puede superar el máximo a financiar";
                mensajeDeError.style = "display: inline-block";
                document.querySelectorAll(`.cuota-valor`).forEach((element) => {
                    element.innerText = '--';
                });
                return;
            }

            setFinancingValues();
        });

        btnSelectCar.addEventListener('click', (event) => {
            event.preventDefault();
            resetValues();
            document.querySelector(".calculadora-container").style = "height: auto; overflow-y: hidden";

            showPageMobileWhitOutfinancing()

        });

        btnCotizarDesktop.addEventListener('click', (event) => {
            event.preventDefault();
            if (montoSolicitadoContainer.value.length === 0) {
                montoSolicitadoContainer.classList.add("error-active");
            } else {
                sendWhatsAppMessage();
            }
        });

        btnCotizarMobile.addEventListener('click', (event) => {
            event.preventDefault();
            if (montoSolicitadoContainer.value.length === 0) {
                montoSolicitadoContainer.classList.add("error-active");
            } else {
                sendWhatsAppMessage();
            }
        });

        btnVerCuotas.addEventListener('click', () => {
            showSecondPageMobile = true;

            montoSolicitadoContainer.classList.add("input-second-page-mobile");

            // Ocultar el botón
            document.querySelector(".ver-cuotas").style = "display: none";
            document.querySelector(".monto-a-financiar-mobile").style = "display: inline-block";

            // Mostrar los contenedores
            cuotasMobileContainer.style = "display: inline-block";
            cotizarMobileContainer.style = "display: flex";

            // Adaptar la calculadora al tamaño de la pantalla con scroll vertical.
            document.querySelector(".calculadora-container").style = "height: 97dvh; overflow-y: scroll";
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth > 767) {
                cuotasMobileContainer.style = "display: none !important;";
                cotizarMobileContainer.style = "display: none !important;";
                btnVerCuotas.style = "display: none;";
                document.querySelector(".monto-a-financiar-mobile").style = "display: none";
                montoSolicitadoContainer.classList.remove("input-second-page-mobile");
                document.querySelector(".calculadora-container").style = "height: auto; overflow-y: hidden";

            } else if (window.innerWidth <= 767 && showSecondPageMobile) {
                cuotasMobileContainer.style = "display: inline-block;";
                cotizarMobileContainer.style = "display: flex;";
                document.querySelector(".monto-a-financiar-mobile").style = "display: inline-block";
                montoSolicitadoContainer.classList.add("input-second-page-mobile");
                document.querySelector(".calculadora-container").style = "height: 97dvh; overflow-y: scroll";
            } else if (window.innerWidth <= 767 && !showSecondPageMobile) {
                btnVerCuotas.style = "display: inline;";
                document.querySelector(".monto-a-financiar-mobile").style = "display: none";
            }
        });


        btnVolver.addEventListener('click', () => {
            showSecondPageMobile = false;

            showPageMobileWhitOutfinancing();

            // Adaptar la calculadora al tamaño de la pantalla con scroll vertical.
            document.querySelector(".calculadora-container").style = "height: auto; overflow-y: hidden";
        });

        montoSolicitadoContainer.addEventListener('input', function () {
            let valorSinFormato = this.value.replace(/[\.$]/g, '');
            valorIngresado = parseInt(valorSinFormato, 10);

            if (valorIngresado > maxAFinanciar) {
                valorIngresado = maxAFinanciar;
            }

            if (!isNaN(valorIngresado)) {
                const productoSeleccionado = ltvData[selectedProduct];
                if (!productoSeleccionado) {
                    console.error('No se encontraron datos válidos para el producto seleccionado.');
                    return;
                }

                const plazos = productoSeleccionado.plazos;

                let valorFormateado = valorIngresado.toLocaleString('es-AR');
                this.value = '$' + valorFormateado;

                [12, 24, 36, 48, 60].forEach(plazo => {
                    if (plazos[plazo]) {
                        desglosarCuotas(valorIngresado, parseFloat(plazos[plazo].interest), plazo, plazos[plazo].fee);
                    } else {
                        console.warn(`No se encontraron datos para el plazo ${plazo}`);
                    }
                });
            } else if (this.value === '') {
                btnCotizarDesktop.classList.remove('disabled');
                btnCotizarMobile.classList.remove('disabled');
                mensajeDeError.style = "display: none";
                montoSolicitadoContainer.classList.remove("error-active");
                document.querySelectorAll(`.cuota-valor`).forEach((element) => {
                    element.innerText = '--';
                });
            }
        });

        function isTokenExpired(token) {
            if (token) {
                // Dividir el token en sus tres partes (header, payload, signature)
                const tokenParts = token.split('.');

                if (tokenParts.length !== 3) {
                    // Si el token no tiene tres partes, no es un JWT válido
                    return true;
                }

                // Decodificar la parte del payload que contiene los datos del token
                const payload = JSON.parse(atob(tokenParts[1]));

                // Extraer el tiempo de expiración (exp)
                const exp = payload.exp;

                if (!exp) {
                    // Si no existe la propiedad exp en el token, considerar que ha expirado
                    return true;
                }

                // Obtener el tiempo actual en segundos desde el epoch
                const now = Math.floor(Date.now() / 1000);

                // Verificar si el token ha expirado
                return now >= exp;
            } else {
                return true
            }
        }</script>
</body>

</html>